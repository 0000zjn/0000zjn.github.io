---
title: 建站日志
date: 2019-01-24 16:10
updated: 2020-05-22 17:55
tags: 项目
---
> 本站的搭建流程

<!-- more -->

# 1. Hexo博客框架

[Hexo：快速、简洁且高效的博客框架](https://hexo.io/zh-cn/docs/)

# 2. yilia主题

[hexo：yilia](https://github.com/litten/hexo-theme-yilia)

# 3. Hexo+Github实现相册功能

## 3.1 教程
[Lawlite：Hexo+Github实现相册功能](http://lawlite.me/2017/04/13/Hexo-Github%E5%AE%9E%E7%8E%B0%E7%9B%B8%E5%86%8C%E5%8A%9F%E8%83%BD/#more)
[wardseptember：补充教程，解决缩略图不显示等问题](https://blog.csdn.net/wardseptember/article/details/82780684)

## 3.2 参考实现
[Litten的博客备份](https://github.com/litten/BlogBackup)
[lawlite的博客备份](https://github.com/lawlite19/Blog-Back-Up)

# 4. hexo+yilia主题添加文章访问量统计(2019-03-28)
[https://blog.csdn.net/qq_40910541/article/details/80659193](https://blog.csdn.net/qq_40910541/article/details/80659193)

## 4.1 引入[不蒜子](http://busuanzi.ibruce.info/)
将下面代码添加在 /themes/yilia/layout/_partial/footer.ejs 的末尾
```
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
```

## 4.2 添加站点访问量
将下面代码添加在 /themes/yilia/layout/_partial/footer.ejs 中末尾。
```
<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
```

## 4.3 添加文章访问量
添加在/themes/yilia/layout/_partial/article.ejs的header的日期后面：
```
<header class="article-header">
<%- partial('post/title', {class_name: 'article-title'}) %>
<% if (!post.noDate){ %>
<%- partial('post/date', {class_name: 'archive-article-date', date_format: null}) %>
<% } %>

<!-- 添加代码 -->
<% if ( !index ){ %>
    <span class="archive-article-date">
    阅读量 <span id="busuanzi_value_page_pv"></span>
    </span>
<% } %>

</header>
```

# 5.踩坑
## 5.1 缺少Deployer

```
ERROR Deployer not found: git
```
hexo初始化可能不自带这个包，要手动安装
```
npm install hexo-deployer-git
```

## 5.2 SSH问题
使用SSH KEY,本地生成id_rsa 和id_rsa_pub文件,并复制id_rsa_pub文件中的内容添加到帐号之后,部署(hexo d)报错:

```shell
Permission denied (publickey).
fatal: Could not read from remote repository.
Please make sure you have the correct access rights
and the repository exists.
FATAL Something's wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html
```

测试当前的SSH是否配置成功,在git bash 中执行命令`ssh -T git@github.com`报错如下:
Permission denied (publickey).

原因:说明当前`SSH`没有配置成功

解决:
请确保以下2步均做到
1、远程服务器已经有了对应于本地主机上公钥
2、本地主机ssh服务开启(windows上是ssh-agent.exe运行)，并且本地主机私钥要包含在ssh服务列表中

- 第一步已经完成,已经将`id_rsa.pub`文件中的内容添加到了github帐号

- 第二步：检查本地私钥是否存在于ssh服务中

```
cd ~/.ssh
eval 'ssh-agent -s'
```
如果运行这句出现Could not open a connection to your authentication agent，那么就先运行
`ssh-agent bash`
再运行
`ssh-add -l`
如果不存在，需要添加进去
`ssh-add ~/.ssh/id_rsa`
添加完成之后,再执行`ssh -T git@github.com`测试SSH是否配置成功!!!

如果出现以下内容说明配置成功

```
Hi username! You've successfully authenticated,
 but GitHub does not provide shell access.
```

## 5.3 仓库设置问题
源代码分支可以正常提交，deploy失败，ssh连接建立成功。
原因：
clone时使用了https，这个信息保存在`.git/config`里，但是在yml中设置的是`git@`开头的ssh地址。

解决方案，修改`.git/config`里的仓库地址，与yml一致。
